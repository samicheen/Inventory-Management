<app-modal [modalRef]="modalRef" 
            title="Send to Manufacturing">
    <form [formGroup]="addManufacturingForm">
        <!-- Show source item info if from barcode scan -->
        <div *ngIf="barcode && item" class="alert alert-info">
            <strong><i class="fa fa-barcode"></i> Source:</strong> {{item.name}} 
            Grade: {{item.grade}} Size: {{item.size}}<br>
            <strong>Barcode:</strong> {{barcode}}<br>
            <strong>Available:</strong> {{available_quantity?.value}} {{quantityUnitToLabelMapping[available_quantity?.unit || 'KG']}}
            <span *ngIf="rate"> at Rs. {{rate}}/{{quantityUnitToLabelMapping[available_quantity?.unit || 'KG']}}</span>
        </div>

        <div class="form-group">
            <label for="timestamp"><i class="fa fa-calendar"></i> Date</label>
            <input type="text"
                class="form-control"
                bsDatepicker
                formControlName="timestamp"
                [bsConfig]="{ dateInputFormat: 'DD/MM/YYYY', containerClass: 'theme-dark-blue' }" />
        </div>
        <div class="form-group" formGroupName="quantity">
            <label for="value"><i class="fa fa-balance-scale"></i> Quantity to Send</label>
            <div class="input-group">
                <input appDecimalNumber type="text"
                    class="form-control"
                    id="value"
                    formControlName="value"
                    [max]="available_quantity?.value">
                <div class="input-group-append">
                    <select class="custom-select" formControlName="unit">
                        <option *ngFor="let unit of unitValues"
                                [value]="unit">
                            {{ quantityUnitToLabelMapping[unit] }}
                        </option>
                        </select>
                </div>
            </div>
            <small *ngIf="available_quantity" class="form-text text-muted">
                Max: {{available_quantity.value}} {{quantityUnitToLabelMapping[available_quantity.unit]}}
            </small>
            <div *ngIf="value.touched && value.errors?.required" class="alert alert-danger">
                <div>Quantity is required.</div>
            </div>
            <div *ngIf="value.touched && value.errors?.max" class="alert alert-danger">
                <div>Quantity cannot exceed {{available_quantity?.value}} {{quantityUnitToLabelMapping[available_quantity?.unit]}}.</div>
            </div>
        </div>
        <div class="button-group">
            <div class="button-row">
                <button class="btn btn-primary"
                        [disabled]="!addManufacturingForm.valid"
                        (click)="addManufacturing()">Add to Manufacturing</button> 
            </div>
        </div>
    </form>
</app-modal>
