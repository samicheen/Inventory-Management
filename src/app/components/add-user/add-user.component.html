<app-modal [modalRef]="modalRef" [title]="isEditMode ? 'Edit User' : 'Add User'">
  <form [formGroup]="addUserForm" (ngSubmit)="addUser()">
    <div class="form-group">
      <label for="username">Username</label>
      <input type="text" 
             id="username"
             class="form-control" 
             formControlName="username"
             placeholder="Enter username"
             [class.is-invalid]="username?.invalid && username?.touched">
      <div class="invalid-feedback" *ngIf="username?.invalid && username?.touched">
        <div *ngIf="username?.errors?.required">Username is required</div>
        <div *ngIf="username?.errors?.minlength">Username must be at least 3 characters</div>
      </div>
    </div>

    <div class="form-group">
      <label for="email">Email</label>
      <input type="email" 
             id="email"
             class="form-control" 
             formControlName="email"
             placeholder="Enter email"
             [class.is-invalid]="email?.invalid && email?.touched">
      <div class="invalid-feedback" *ngIf="email?.invalid && email?.touched">
        <div *ngIf="email?.errors?.required">Email is required</div>
        <div *ngIf="email?.errors?.email">Invalid email format</div>
      </div>
    </div>

    <div class="form-group">
      <label for="password">{{isEditMode ? 'New Password (leave blank to keep current)' : 'Password'}}</label>
      <input type="password" 
             id="password"
             class="form-control" 
             formControlName="password"
             [placeholder]="isEditMode ? 'Enter new password (optional)' : 'Enter password'"
             [class.is-invalid]="password?.invalid && password?.touched">
      <div class="invalid-feedback" *ngIf="password?.invalid && password?.touched">
        <div *ngIf="password?.errors?.required">Password is required</div>
        <div *ngIf="password?.errors?.minlength">Password must be at least 6 characters</div>
      </div>
    </div>

    <div class="form-group" *ngIf="!isEditMode || password?.value">
      <label for="confirmPassword">Confirm Password</label>
      <input type="password" 
             id="confirmPassword"
             class="form-control" 
             formControlName="confirmPassword"
             placeholder="Confirm password"
             [class.is-invalid]="confirmPassword?.invalid && confirmPassword?.touched">
      <div class="invalid-feedback" *ngIf="confirmPassword?.invalid && confirmPassword?.touched">
        <div *ngIf="confirmPassword?.errors?.required">Please confirm password</div>
        <div *ngIf="confirmPassword?.errors?.passwordMismatch">Passwords do not match</div>
      </div>
    </div>

    <div class="form-group">
      <label for="role">Role</label>
      <select class="form-control" 
              id="role"
              formControlName="role"
              [class.is-invalid]="role?.invalid && role?.touched">
        <option value="user">User</option>
        <option value="admin">Admin</option>
      </select>
      <div class="invalid-feedback" *ngIf="role?.invalid && role?.touched">
        Role is required
      </div>
    </div>

    <div class="button-group">
      <div class="button-row">
        <button type="submit" 
                class="btn btn-primary"
                [disabled]="addUserForm.invalid">
          <i class="fa fa-save"></i> {{isEditMode ? 'Update' : 'Create'}} User
        </button>
        <button type="button" 
                class="btn btn-secondary" 
                (click)="modalRef.hide()">
          <i class="fa fa-times"></i> Cancel
        </button>
      </div>
    </div>
  </form>
</app-modal>

